# 2. MODELLING AND FORECASTING

## 2.1 Aquifers
  
## 2.2 Water Springs

### 2.2.1 Madonna di Canneto

#### Choosing the best model

After performing autoML on all datasets of Madonna di Canneto (original and featured), **GBM** resulted to be the best regression model. This coincided with a check we did on RapidMiner.

  ![varimp h2o jpg](https://user-images.githubusercontent.com/43357858/108821918-9d67e580-75be-11eb-82ec-276d1e28cbe2.png)

Instead, after performing autoTS we found tbats to be the best performance as timeseries model.

```
# Comparison of TS model errors (RMSE)
  prophet   ets sarima tbats  bats  stlm shortterm bagged
    <dbl> <dbl>  <dbl> <dbl> <dbl> <dbl>     <dbl>  <dbl>
1    32.9  2.58   7.64  1.27  2.54  6.08      2.76   3.59
```

![autoTS_res jpg](https://user-images.githubusercontent.com/43357858/108823840-431c5400-75c1-11eb-99e0-e8cb8dd83e10.png)

We also plotted predicted vs actual values for tbats.

![tbats](https://user-images.githubusercontent.com/43357858/108824227-c76ed700-75c1-11eb-90ab-e921b2c10269.jpg)

From the plot above we decided not to use tbats, but just to continue with gbm. 

#### Model results 

##### Gradient Boost Machine 

We compared GBM error results between the five different timeseries with changing thresholds, and concluded that the best fit was for the original timseries, with no changes to the minimum rainfall values. 

We then compared RMSE results between the original timeseries and all its features, and the original timseries with feature selection made with stepwise regression. The former GBM model resulted in an RMSE of 26.05 L/s, while the latter resulted in 25.97 L/s. We thus chose the second model. 

The following graph shows the relationship between predicted and actual target values of the best model. 

![gbm_act_pred](https://user-images.githubusercontent.com/43357858/108829952-179d6780-75c9-11eb-8271-834b9b4456b1.jpg)

The model showed that temperature has the greatest influence over flow rate (50%), followed by the 8-day time lag of rainfall. 

![rel_infl gbm](https://user-images.githubusercontent.com/43357858/108829984-1f5d0c00-75c9-11eb-9920-d2bbc18bc9cc.jpg)

## 2.3 River

## 2.4 Lake