# 1. Data Cleaning and Feature Engineering

## 1.1 Aquifers

## 1.2 Water Springs

### 1.2.1 Madonna di Canneto

Madonna di Canneto presented few variables, 3 features (two meteorological and time) and Flow Rate (L/s) as target. 

From the first look at the percentage of missing data, we noticed that the target variable presented the largest % of missing variables. 

```
# A tibble: 4 x 3
  variable                     n_miss pct_miss
  <chr>                         <int>    <dbl>
1 Flow_Rate_Madonna_di_Canneto   1726   55.4  
2 Rainfall_Settefrati             556   17.9  
3 Temperature_Settefrati          556   17.9  
```

We then observed the distribution of the target variable over time to visualise where missing values were **located**.

![first_look_target_canneto](https://user-images.githubusercontent.com/43357858/108752197-73251200-7543-11eb-99e4-53a7b49c0ab4.jpg)

Effectively, the major gap in data was located in the earlier years available in the dataset, including a large gap throughout 2015. We opted to filter the dataset from the beginning of 2016 to proceed with our analyses. 

Even after removing the first gaps, the target variable still presented major areas of missing values, as shown in the image below. We proceeded with imputing the missing values with the moving average (*imputeTS* package).

![na_dist_cannetof](https://user-images.githubusercontent.com/43357858/108750159-fe50d880-7540-11eb-9b7d-d0f9e9a0aeca.jpg)

Also the features presented gaps after filtering out the dataset until 2016, which we enriched with data retrieved from [3bmeteo archive, location: Settefrati](https://www.3bmeteo.com/meteo/settefrati/storico).

So we could finally see both meteorological values in their full and continuous distribution over time. 

![panel_meteo_canneto](https://user-images.githubusercontent.com/43357858/108750164-fee96f00-7540-11eb-9fd0-ddc690ec8dd1.jpg)

Finally, we checked for outliers and found none neither in the target nor in the temperature variable. For precipitation we decided not to modify them as they were many and scattered throughout the dataset, and not showing any particularly odd behaviour. 

#### Feature Engineering 

In terms of feature engineering, after calculating mean weekly rainfall values, we decided to set the new minimum threshold values at 0.8mm, 1.5mm, 2.8mm and 4.4mm. 

![panelled_rain](https://user-images.githubusercontent.com/43357858/108819954-cdfa5000-75bb-11eb-916c-6c71ef348fea.jpg)

The Aikaike Information Criteria (AIC) suggested the best number of lags to be of 8 days, and so we added this new feature to each new timeseries.



------------------------------

## 1.3 River 

## 1.4 Lake